# 基本概念

有几个概念是Elasticsearch的核心。从一开始就理解这些概念将能极大地简化学习过程。

\#\#\# Near Realtime（准实时）

Elasticsearch是一个接近实时的搜索平台。这意味着从索引文档到可搜索文档之间有一个轻微的延迟\(通常是一秒钟\)。

\#\#\# Cluster（集群）

集群是一个或多个节点的集合，它们一起保存整个数据，所有节点联合提供索引和搜索功能。集群由一个惟一的名称标识，默认情况下该名称是“elasticsearch”。这个名称很重要，因为只有将节点设置为按其名称加入集群时，节点才能成为集群的一部分。

确保不要在不同的环境中重用相同的集群名称，否则可能会导致节点加入错误的集群。例如，您可以对开发、测试和生产集群使用不同的名称。

注意，只有一个节点的集群是有效的，而且没有问题。此外，您还可以拥有多个独立的集群，每个集群都有自己独特的集群名称。

\#\#\# Node（节点）

一个节点是一个独立的服务，它是集群的一部分，存储数据，并参与集群的索引和搜索功能。与集群一样，节点也是通过名称来标识的，默认情况下，名称是在启动时分配给节点的随机全局惟一标识符\(UUID\)。如果不需要缺省值，可以定义任何需要的节点名称。对于您想要标识网络中的哪些服务器对应于Elasticsearch集群中的哪些节点的管理目的，这个名称非常重要。

可以通过集群名称将节点配置为连接特定的集群。默认情况下，每个节点都被设置为加入一个名为elasticsearch的集群，这意味着如果您启动网络上的多个节点，假设它们能够彼此发现，它们将自动形成并加入一个名为elasticsearch的集群。

在单个集群中，您可以拥有任意多的节点。此外，如果您的网络上没有其他运行的Elasticsearch节点，那么默认情况下，启动单个节点将形成一个名为Elasticsearch的新单节点集群。

\#\#\# Index（索引）

索引是具有某种类似特征的文档集合。例如，可以为客户数据建立索引，为产品目录建立另一个索引，为订单数据建立另一个索引。索引名称标识必须全部为小写，当对其中的文档执行索引、搜索、更新和删除操作时，此名称用于引用索引。

在一个集群中，您可以定义任意多的索引。

\#\#\# Type（类型）

类型是索引的逻辑分区，在同一个索引中可以存储不同类型的文档，例如，一种类型用于用户，另一种类型用于博客文章。在索引中不再可能创建多个类型，在稍后的版本中将删除类型的整个概念。（类型将在Elasticsearch 7.0.0的api中被弃用，并在8.0.0中完全删除。）

\#\#\# Document（文档）

文档是可以建立索引的基本信息单元。例如，您可以为单个客户创建一个文档，为单个产品创建另一个文档，为单个订单创建另一个文档。该文档用JSON \(JavaScript对象表示法\)表示，这是一种无处不在的internet数据交换格式。

在索引/类型中，可以存储任意数量的文档。请注意，尽管文档在物理上驻留在索引中，但是文档实际上必须被索引/分配给索引中的类型。

\#\#\# Shards & Replicas（分片和复制）

索引可以存储大量数据，这些数据可能超过单个节点的硬件限制。例如，一个包含10亿个文档的索引占用1TB的磁盘空间，这个索引可能不适用于单个节点的磁盘，或者速度太慢，单个节点无法满足搜索需求。

为了解决这个问题，Elasticsearch提供了将索引细分为多个分片的功能。创建索引时，可以简单地定义所需的分片数量。每个分片本身都是一个功能齐全且独立的“索引”，可以托管在集群中的任何节点上。

分片之所以重要，主要有两个原因:

\* 它允许您水平分割扩展数据

\* 它允许\(可能在多个节点上\)分布和并行化操作，从而提高性能/吞吐量

分片如何分布以及如何将其文档聚合回搜索请求的机制完全由Elasticsearch管理，并且对用户是透明的。

在随时可能出现故障的网络/云环境中，如果分片/节点由于某种原因离线或消失，那么使用故障转移机制是非常有用的，强烈建议使用这种机制。为此，Elasticsearch允许您将索引分片的一个或多个副本复制为所谓的复制分片，或简称为副本。

复制之所以重要，主要有两个原因:

\* 它在分片/节点失败时提供高可用性。出于这个原因，需要注意的是，复制分片永远不会与复制它的原始/主分片分配在相同的节点上。

\* 它允许您扩展搜索量/吞吐量，因为可以在所有副本上并行执行搜索。

总而言之，每个索引可以分成多个分片。索引也可以被复制零次\(即没有副本\)或多次。复制后，每个索引将具有主分片\(从其中复制的原始分片\)和复制分片\(主分片的副本\)。

可以在创建索引时为每个索引定义分片和副本的数量。创建索引之后，还可以随时动态更改副本的数量。您可以使用\_shrink和\_split api更改现有索引的分片数量，但是这不是一件容易的事，预先计划正确的分片数量是最佳方法。

默认情况下，Elasticsearch中的每个索引分配5个主分片和1个副本，这意味着如果您的集群中至少有两个节点，那么您的索引将有5个主分片和另外5个副本分片\(一个完整的副本\)，每个索引总共有10个分片。

&gt;\[info\] 注：每个Elasticsearch分片都是一个Lucene索引。在一个Lucene索引中可以包含最多的文档数：在LUCENE-5843中，上限是2,147,483,519个文档。可以使用\_cat/shards API监视分片大小。



